<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        /*div{*/
        /*    width: 300px;*/
        /*    height: 300px;*/
        /*    border: 1px solid black;*/
        /*}*/
    </style>
</head>
<body>
<input type="text" placeholder="请输入发送的内容">
<button id="button">发送消息</button>
<div></div>
<script>
    var input = document.querySelector('input')
    var button = document.querySelector('button')
    var div = document.querySelector('div')
    // websocket在浏览器端如何使用
    //H5直接提供了Websocket API

    //参数1：Websocket服务地址
    var socket = new WebSocket('ws://localhost:8080/websocket/chat')
    //open:连接成功的监听
    socket.addEventListener('open', function (){
        div.innerHTML = '连接服务成功了'
    })
    //监听发送消息(监听发送按钮)
    button.addEventListener('click', function () {
        var value = input.value
        socket.send(value)
        // console.log('发送成功！！！！！！！！！！')
        // 清空输入框
        input.value = ''
    })

    // socket.addEventListener('click', function (){
    //     var value = input.value
    //     socket.send(value)
    //     console.log('发送成功！！！！！！！！！！')
    // })
    // 收到消息
    // socket.addEventListener('onMessage', function (e){
    //     //浏览器控制台打印出消息
    //     console.log(e.data)
    //     // var msg = JSON.parse(e.data)
    //     //这会覆盖显示
    //     // div.innerHTML = e.data
    //     var dv = document.createElement('div')
    //     // dv.innerText = msg.msgInfo + '--------' + msg.msgDateTime
    //     dv.innerText = e.data
    //     //把dv加入div上
    //     div.appendChild(dv)
    // })
    // 收到消息
    socket.addEventListener('message', function (e){
        //浏览器控制台打印出消息
        console.log(e.data)
        var msgJson = JSON.parse(e.data);
        //这会覆盖显示
        // div.innerHTML = e.data
        var dv = document.createElement('div')
        dv.innerText = msgJson.msgInfo + msgJson.msgDateTimeStr
        if(msgJson.msgType == 0){
            dv.style.color = 'green'
        } else if (msgJson.msgType == 1){
            dv.style.color = 'red'
        } else {
            dv.style.color = 'blue'
        }
        // dv.innerText = e.data
        //把dv加入div上
        div.appendChild(dv)
    })
    //监听关闭事件
    socket.addEventListener('close', function (){

    })
</script>
</body>
</html>